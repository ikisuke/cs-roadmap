<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>アセンブリ言語 - コンピューターサイエンス学習ガイド</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #16a085 0%, #f4d03f 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .breadcrumb {
            background: #ecf0f1;
            padding: 15px 40px;
            border-bottom: 1px solid #bdc3c7;
        }

        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
            margin-right: 10px;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #16a085;
        }

        .section h2 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 10px;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .concept-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #16a085;
            transition: all 0.3s ease;
        }

        .concept-card:hover {
            background: #e8f8f5;
            border-left-color: #1abc9c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .concept-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .code-editor {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        .code-editor::before {
            content: '● ● ●';
            position: absolute;
            top: 10px;
            left: 20px;
            color: #e74c3c;
            font-size: 1.2rem;
        }

        .code-editor-title {
            margin-top: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            color: #f39c12;
        }

        .code-line {
            margin: 8px 0;
            position: relative;
            padding-left: 50px;
        }

        .code-line::before {
            content: attr(data-line);
            position: absolute;
            left: 0;
            color: #7f8c8d;
            width: 40px;
            text-align: right;
        }

        .keyword {
            color: #3498db;
            font-weight: bold;
        }

        .register {
            color: #e74c3c;
            font-weight: bold;
        }

        .immediate {
            color: #f39c12;
        }

        .comment {
            color: #95a5a6;
            font-style: italic;
        }

        .label {
            color: #9b59b6;
            font-weight: bold;
        }

        .instruction-table {
            overflow-x: auto;
            margin: 20px 0;
        }

        .instruction-table table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .instruction-table th {
            background: #16a085;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .instruction-table td {
            padding: 12px;
            border-bottom: 1px solid #ecf0f1;
            font-family: 'Courier New', monospace;
        }

        .instruction-table tbody tr:hover {
            background: #f8f9fa;
        }

        .assembly-demo {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .demo-btn {
            background: #16a085;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-btn:hover {
            background: #138d75;
            transform: translateY(-2px);
        }

        .demo-btn.active {
            background: #e74c3c;
        }

        .registers-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .register-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #16a085;
            transition: all 0.3s ease;
        }

        .register-box.highlight {
            border-color: #e74c3c;
            background: #fdedec;
        }

        .register-name {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .register-value {
            font-family: 'Courier New', monospace;
            font-size: 1.2rem;
            color: #16a085;
        }

        .memory-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid #16a085;
        }

        .memory-row {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
        }

        .memory-address {
            width: 100px;
            color: #7f8c8d;
        }

        .memory-value {
            color: #2c3e50;
            font-weight: bold;
        }

        .interactive-assembler {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .assembler-input {
            width: 100%;
            height: 200px;
            font-family: 'Courier New', monospace;
            padding: 15px;
            border: 2px solid #16a085;
            border-radius: 8px;
            background: #2c3e50;
            color: #ecf0f1;
            font-size: 14px;
            resize: vertical;
        }

        .assembler-output {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #16a085;
            font-family: 'Courier New', monospace;
            min-height: 100px;
        }

        .practice-section {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border: 2px solid #f39c12;
        }

        .practice-title {
            color: #856404;
            font-size: 1.3rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exercise {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #f39c12;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px;
            background: #ecf0f1;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(45deg, #16a085, #1abc9c);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(22, 160, 133, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(149, 165, 166, 0.4);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }

            .header {
                padding: 30px 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 20px;
            }

            .section {
                padding: 20px;
            }

            .concept-grid {
                grid-template-columns: 1fr;
            }

            .demo-controls {
                flex-direction: column;
                align-items: center;
            }
        }

        .status-bar {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 アセンブリ言語</h1>
            <p>ハードウェアとの対話 - 低レベルプログラミングの基礎</p>
        </div>

        <div class="breadcrumb">
            <a href="index.html">🏠 ロードマップ</a> > 
            <a href="#phase3">Phase 3: コンピュータアーキテクチャ</a> > 
            <span>アセンブリ言語</span>
        </div>

        <div class="content">
            <!-- 概要セクション -->
            <div class="section">
                <h2>🎯 学習目標</h2>
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">アセンブリ言語の基礎</div>
                        <p>機械語とアセンブリの関係、ニーモニックとオペランド</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">命令セットの理解</div>
                        <p>算術演算、論理演算、分岐、メモリアクセス命令</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">レジスタとメモリ操作</div>
                        <p>レジスタファイル、スタック、ヒープの効率的な利用</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">プログラム構造</div>
                        <p>ラベル、関数呼び出し、システムコールの実装</p>
                    </div>
                </div>
            </div>

            <!-- アセンブリ基礎 -->
            <div class="section">
                <h2>📝 アセンブリ言語の基礎</h2>
                
                <h3>機械語とアセンブリの関係</h3>
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">機械語</div>
                        <p>CPUが直接実行できる2進数の命令コード<br>
                        例: 10110000 01100001</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">アセンブリ語</div>
                        <p>機械語を人間が読みやすい形に表現<br>
                        例: MOV AL, 97</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">アセンブラ</div>
                        <p>アセンブリ語を機械語に変換するプログラム<br>
                        1対1の対応関係で変換</p>
                    </div>
                </div>

                <h3>基本的なプログラム例</h3>
                <div class="code-editor">
                    <div class="code-editor-title">Hello World (x86-64 Assembly)</div>
                    <div class="code-line" data-line="1"><span class="label">section</span> <span class="keyword">.data</span></div>
                    <div class="code-line" data-line="2">    msg <span class="keyword">db</span> <span class="immediate">'Hello, World!', 0xA</span>, <span class="immediate">0</span> <span class="comment">; メッセージと改行</span></div>
                    <div class="code-line" data-line="3">    msg_len <span class="keyword">equ</span> <span class="immediate">$ - msg</span> <span class="comment">; メッセージの長さ</span></div>
                    <div class="code-line" data-line="4"></div>
                    <div class="code-line" data-line="5"><span class="label">section</span> <span class="keyword">.text</span></div>
                    <div class="code-line" data-line="6">    <span class="keyword">global</span> <span class="label">_start</span></div>
                    <div class="code-line" data-line="7"></div>
                    <div class="code-line" data-line="8"><span class="label">_start:</span></div>
                    <div class="code-line" data-line="9">    <span class="keyword">mov</span> <span class="register">rax</span>, <span class="immediate">1</span>      <span class="comment">; write システムコール</span></div>
                    <div class="code-line" data-line="10">    <span class="keyword">mov</span> <span class="register">rdi</span>, <span class="immediate">1</span>      <span class="comment">; 標準出力</span></div>
                    <div class="code-line" data-line="11">    <span class="keyword">mov</span> <span class="register">rsi</span>, msg    <span class="comment">; メッセージのアドレス</span></div>
                    <div class="code-line" data-line="12">    <span class="keyword">mov</span> <span class="register">rdx</span>, msg_len <span class="comment">; メッセージの長さ</span></div>
                    <div class="code-line" data-line="13">    <span class="keyword">syscall</span>           <span class="comment">; システムコール実行</span></div>
                    <div class="code-line" data-line="14"></div>
                    <div class="code-line" data-line="15">    <span class="keyword">mov</span> <span class="register">rax</span>, <span class="immediate">60</span>     <span class="comment">; exit システムコール</span></div>
                    <div class="code-line" data-line="16">    <span class="keyword">mov</span> <span class="register">rdi</span>, <span class="immediate">0</span>      <span class="comment">; 終了コード</span></div>
                    <div class="code-line" data-line="17">    <span class="keyword">syscall</span>           <span class="comment">; プログラム終了</span></div>
                </div>
            </div>

            <!-- 命令セット -->
            <div class="section">
                <h2>⚡ 基本命令セット</h2>
                
                <h3>データ移動命令</h3>
                <div class="instruction-table">
                    <table>
                        <thead>
                            <tr>
                                <th>命令</th>
                                <th>説明</th>
                                <th>例</th>
                                <th>動作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>MOV</td>
                                <td>データ移動</td>
                                <td>MOV EAX, EBX</td>
                                <td>EBXの値をEAXにコピー</td>
                            </tr>
                            <tr>
                                <td>LEA</td>
                                <td>アドレス計算</td>
                                <td>LEA EAX, [EBX+4]</td>
                                <td>EBX+4のアドレスをEAXに格納</td>
                            </tr>
                            <tr>
                                <td>XCHG</td>
                                <td>値の交換</td>
                                <td>XCHG EAX, EBX</td>
                                <td>EAXとEBXの値を交換</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>算術演算命令</h3>
                <div class="instruction-table">
                    <table>
                        <thead>
                            <tr>
                                <th>命令</th>
                                <th>説明</th>
                                <th>例</th>
                                <th>動作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ADD</td>
                                <td>加算</td>
                                <td>ADD EAX, EBX</td>
                                <td>EAX = EAX + EBX</td>
                            </tr>
                            <tr>
                                <td>SUB</td>
                                <td>減算</td>
                                <td>SUB EAX, EBX</td>
                                <td>EAX = EAX - EBX</td>
                            </tr>
                            <tr>
                                <td>MUL</td>
                                <td>符号なし乗算</td>
                                <td>MUL EBX</td>
                                <td>EDX:EAX = EAX * EBX</td>
                            </tr>
                            <tr>
                                <td>DIV</td>
                                <td>符号なし除算</td>
                                <td>DIV EBX</td>
                                <td>EAX = EDX:EAX / EBX</td>
                            </tr>
                            <tr>
                                <td>INC</td>
                                <td>インクリメント</td>
                                <td>INC EAX</td>
                                <td>EAX = EAX + 1</td>
                            </tr>
                            <tr>
                                <td>DEC</td>
                                <td>デクリメント</td>
                                <td>DEC EAX</td>
                                <td>EAX = EAX - 1</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>論理演算・比較命令</h3>
                <div class="instruction-table">
                    <table>
                        <thead>
                            <tr>
                                <th>命令</th>
                                <th>説明</th>
                                <th>例</th>
                                <th>動作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>AND</td>
                                <td>論理積</td>
                                <td>AND EAX, EBX</td>
                                <td>EAX = EAX & EBX</td>
                            </tr>
                            <tr>
                                <td>OR</td>
                                <td>論理和</td>
                                <td>OR EAX, EBX</td>
                                <td>EAX = EAX | EBX</td>
                            </tr>
                            <tr>
                                <td>XOR</td>
                                <td>排他的論理和</td>
                                <td>XOR EAX, EBX</td>
                                <td>EAX = EAX ^ EBX</td>
                            </tr>
                            <tr>
                                <td>NOT</td>
                                <td>論理否定</td>
                                <td>NOT EAX</td>
                                <td>EAX = ~EAX</td>
                            </tr>
                            <tr>
                                <td>CMP</td>
                                <td>比較</td>
                                <td>CMP EAX, EBX</td>
                                <td>EAX - EBXを計算してフラグ設定</td>
                            </tr>
                            <tr>
                                <td>TEST</td>
                                <td>論理積テスト</td>
                                <td>TEST EAX, EBX</td>
                                <td>EAX & EBXを計算してフラグ設定</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h3>分岐・ジャンプ命令</h3>
                <div class="instruction-table">
                    <table>
                        <thead>
                            <tr>
                                <th>命令</th>
                                <th>説明</th>
                                <th>条件</th>
                                <th>使用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>JMP</td>
                                <td>無条件ジャンプ</td>
                                <td>常に</td>
                                <td>JMP label</td>
                            </tr>
                            <tr>
                                <td>JE/JZ</td>
                                <td>等しい場合ジャンプ</td>
                                <td>ZF = 1</td>
                                <td>CMP EAX, EBX<br>JE equal</td>
                            </tr>
                            <tr>
                                <td>JNE/JNZ</td>
                                <td>等しくない場合ジャンプ</td>
                                <td>ZF = 0</td>
                                <td>CMP EAX, EBX<br>JNE not_equal</td>
                            </tr>
                            <tr>
                                <td>JG/JNLE</td>
                                <td>より大きい場合ジャンプ</td>
                                <td>ZF=0 かつ SF=OF</td>
                                <td>CMP EAX, EBX<br>JG greater</td>
                            </tr>
                            <tr>
                                <td>JL/JNGE</td>
                                <td>より小さい場合ジャンプ</td>
                                <td>SF≠OF</td>
                                <td>CMP EAX, EBX<br>JL less</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- インタラクティブシミュレータ -->
            <div class="section">
                <h2>🎮 アセンブリシミュレータ</h2>
                
                <div class="assembly-demo">
                    <h3>インタラクティブ命令実行</h3>
                    <p>ボタンをクリックして命令を実行し、レジスタとメモリの変化を観察</p>
                    
                    <div class="demo-controls">
                        <button class="demo-btn" onclick="executeInstruction('MOV EAX, 10')">MOV EAX, 10</button>
                        <button class="demo-btn" onclick="executeInstruction('MOV EBX, 5')">MOV EBX, 5</button>
                        <button class="demo-btn" onclick="executeInstruction('ADD EAX, EBX')">ADD EAX, EBX</button>
                        <button class="demo-btn" onclick="executeInstruction('SUB EAX, EBX')">SUB EAX, EBX</button>
                        <button class="demo-btn" onclick="executeInstruction('XOR EAX, EBX')">XOR EAX, EBX</button>
                        <button class="demo-btn" onclick="resetRegisters()">リセット</button>
                    </div>
                    
                    <h4>レジスタの状態</h4>
                    <div class="registers-display">
                        <div class="register-box" id="reg-eax">
                            <div class="register-name">EAX</div>
                            <div class="register-value">0x00000000</div>
                        </div>
                        <div class="register-box" id="reg-ebx">
                            <div class="register-name">EBX</div>
                            <div class="register-value">0x00000000</div>
                        </div>
                        <div class="register-box" id="reg-ecx">
                            <div class="register-name">ECX</div>
                            <div class="register-value">0x00000000</div>
                        </div>
                        <div class="register-box" id="reg-edx">
                            <div class="register-name">EDX</div>
                            <div class="register-value">0x00000000</div>
                        </div>
                        <div class="register-box" id="reg-flags">
                            <div class="register-name">FLAGS</div>
                            <div class="register-value">0x0000</div>
                        </div>
                    </div>
                    
                    <div class="status-bar" id="status-bar">
                        命令を選択して実行してください
                    </div>
                </div>
            </div>

            <!-- インタラクティブアセンブラ -->
            <div class="section">
                <h2>💻 インタラクティブアセンブラ</h2>
                
                <div class="interactive-assembler">
                    <h3>アセンブリコードエディタ</h3>
                    <p>アセンブリコードを入力してアセンブルしてみましょう</p>
                    
                    <textarea class="assembler-input" id="assembly-input" placeholder="アセンブリコードをここに入力...
例:
section .data
    num1 dd 10
    num2 dd 20
    
section .text
    global _start
    
_start:
    mov eax, [num1]
    add eax, [num2]
    mov [result], eax
    
    mov eax, 60
    mov edi, 0
    syscall"></textarea>
                    
                    <div class="demo-controls">
                        <button class="demo-btn" onclick="assembleCode()">アセンブル</button>
                        <button class="demo-btn" onclick="loadExample()">サンプル読み込み</button>
                        <button class="demo-btn" onclick="clearCode()">クリア</button>
                    </div>
                    
                    <h4>アセンブル結果</h4>
                    <div class="assembler-output" id="assembly-output">
                        アセンブルボタンを押すと機械語が表示されます
                    </div>
                </div>
            </div>

            <!-- 関数とスタック -->
            <div class="section">
                <h2>📚 関数呼び出しとスタック</h2>
                
                <h3>スタックの基本操作</h3>
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">PUSH命令</div>
                        <p>データをスタックに積む<br>
                        PUSH EAX → ESP -= 4, [ESP] = EAX</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">POP命令</div>
                        <p>スタックからデータを取り出す<br>
                        POP EAX → EAX = [ESP], ESP += 4</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">関数呼び出し</div>
                        <p>CALL命令で関数を呼び出し<br>
                        戻りアドレスを自動でスタックに保存</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">関数復帰</div>
                        <p>RET命令で呼び出し元に復帰<br>
                        スタックから戻りアドレスを取得</p>
                    </div>
                </div>

                <h3>関数の実装例</h3>
                <div class="code-editor">
                    <div class="code-editor-title">関数による加算プログラム</div>
                    <div class="code-line" data-line="1"><span class="label">section</span> <span class="keyword">.text</span></div>
                    <div class="code-line" data-line="2">    <span class="keyword">global</span> <span class="label">_start</span></div>
                    <div class="code-line" data-line="3"></div>
                    <div class="code-line" data-line="4"><span class="comment">; 加算関数</span></div>
                    <div class="code-line" data-line="5"><span class="label">add_numbers:</span></div>
                    <div class="code-line" data-line="6">    <span class="keyword">push</span> <span class="register">ebp</span>        <span class="comment">; フレームポインタ保存</span></div>
                    <div class="code-line" data-line="7">    <span class="keyword">mov</span> <span class="register">ebp</span>, <span class="register">esp</span>     <span class="comment">; 新しいフレーム設定</span></div>
                    <div class="code-line" data-line="8">    </div>
                    <div class="code-line" data-line="9">    <span class="keyword">mov</span> <span class="register">eax</span>, [<span class="register">ebp</span>+<span class="immediate">8</span>]  <span class="comment">; 第1引数</span></div>
                    <div class="code-line" data-line="10">    <span class="keyword">mov</span> <span class="register">ebx</span>, [<span class="register">ebp</span>+<span class="immediate">12</span>] <span class="comment">; 第2引数</span></div>
                    <div class="code-line" data-line="11">    <span class="keyword">add</span> <span class="register">eax</span>, <span class="register">ebx</span>     <span class="comment">; 加算実行</span></div>
                    <div class="code-line" data-line="12">    </div>
                    <div class="code-line" data-line="13">    <span class="keyword">pop</span> <span class="register">ebp</span>         <span class="comment">; フレームポインタ復元</span></div>
                    <div class="code-line" data-line="14">    <span class="keyword">ret</span>              <span class="comment">; 関数復帰（結果はEAXに）</span></div>
                    <div class="code-line" data-line="15"></div>
                    <div class="code-line" data-line="16"><span class="label">_start:</span></div>
                    <div class="code-line" data-line="17">    <span class="keyword">push</span> <span class="immediate">20</span>        <span class="comment">; 第2引数をプッシュ</span></div>
                    <div class="code-line" data-line="18">    <span class="keyword">push</span> <span class="immediate">15</span>        <span class="comment">; 第1引数をプッシュ</span></div>
                    <div class="code-line" data-line="19">    <span class="keyword">call</span> add_numbers <span class="comment">; 関数呼び出し</span></div>
                    <div class="code-line" data-line="20">    <span class="keyword">add</span> <span class="register">esp</span>, <span class="immediate">8</span>      <span class="comment">; スタック清理（引数2つ分）</span></div>
                    <div class="code-line" data-line="21">    </div>
                    <div class="code-line" data-line="22">    <span class="comment">; 結果（EAX = 35）を使用</span></div>
                    <div class="code-line" data-line="23">    <span class="keyword">mov</span> <span class="register">edi</span>, <span class="register">eax</span>     <span class="comment">; 終了コードとして設定</span></div>
                    <div class="code-line" data-line="24">    <span class="keyword">mov</span> <span class="register">eax</span>, <span class="immediate">60</span>      <span class="comment">; exit システムコール</span></div>
                    <div class="code-line" data-line="25">    <span class="keyword">syscall</span></div>
                </div>
            </div>

            <!-- 実践演習セクション -->
            <div class="practice-section">
                <div class="practice-title">
                    💪 実践演習
                </div>
                
                <div class="exercise">
                    <h4>演習1：基本命令の理解</h4>
                    <p>以下のアセンブリコードを実行した後、各レジスタの値を求めよ：</p>
                    <div class="code-editor" style="margin: 10px 0;">
                        <div class="code-line" data-line="1"><span class="keyword">mov</span> <span class="register">eax</span>, <span class="immediate">10</span></div>
                        <div class="code-line" data-line="2"><span class="keyword">mov</span> <span class="register">ebx</span>, <span class="immediate">3</span></div>
                        <div class="code-line" data-line="3"><span class="keyword">add</span> <span class="register">eax</span>, <span class="register">ebx</span></div>
                        <div class="code-line" data-line="4"><span class="keyword">mul</span> <span class="register">ebx</span></div>
                        <div class="code-line" data-line="5"><span class="keyword">xor</span> <span class="register">ebx</span>, <span class="register">ebx</span></div>
                    </div>
                </div>

                <div class="exercise">
                    <h4>演習2：ループの実装</h4>
                    <p>1から10までの和を計算するアセンブリプログラムを作成せよ。結果はEAXレジスタに格納すること。</p>
                </div>

                <div class="exercise">
                    <h4>演習3：文字列処理</h4>
                    <p>null終端文字列の長さを計算する関数をアセンブリで実装せよ。文字列のアドレスをEBXで受け取り、長さをEAXで返すこと。</p>
                </div>

                <div class="exercise">
                    <h4>演習4：最大値検索</h4>
                    <p>配列内の最大値を見つけるアセンブリプログラムを作成せよ。配列のアドレス、要素数を引数として受け取り、最大値を返すこと。</p>
                </div>
            </div>

            <!-- 次のステップ -->
            <div class="section">
                <h2>🚀 次のステップ</h2>
                <div class="concept-grid">
                    <div class="concept-card">
                        <div class="concept-title">オペレーティングシステム</div>
                        <p>システムコール、プロセス管理、メモリ管理の学習</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">リバースエンジニアリング</div>
                        <p>機械語からアセンブリへの逆変換とデバッグ技術</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">最適化技術</div>
                        <p>コンパイラ最適化とパフォーマンス向上技術</p>
                    </div>
                    <div class="concept-card">
                        <div class="concept-title">組み込みプログラミング</div>
                        <p>マイクロコントローラでの低レベルプログラミング</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="navigation">
            <a href="memory-hierarchy.html" class="btn btn-secondary">← メモリ階層</a>
            <a href="index.html" class="btn btn-secondary">🏠 ロードマップに戻る</a>
            <a href="#" class="btn">オペレーティングシステム →</a>
        </div>
    </div>

    <script>
        // レジスタシミュレータ
        let registers = {
            EAX: 0,
            EBX: 0,
            ECX: 0,
            EDX: 0,
            FLAGS: 0
        };

        function updateRegisterDisplay() {
            Object.keys(registers).forEach(reg => {
                const element = document.getElementById(`reg-${reg.toLowerCase()}`);
                if (element) {
                    const valueElement = element.querySelector('.register-value');
                    if (reg === 'FLAGS') {
                        valueElement.textContent = `0x${registers[reg].toString(16).padStart(4, '0').toUpperCase()}`;
                    } else {
                        valueElement.textContent = `0x${registers[reg].toString(16).padStart(8, '0').toUpperCase()}`;
                    }
                    
                    // ハイライト効果
                    element.classList.add('highlight');
                    setTimeout(() => element.classList.remove('highlight'), 1000);
                }
            });
        }

        function executeInstruction(instruction) {
            const statusBar = document.getElementById('status-bar');
            
            try {
                const parts = instruction.split(/[\s,]+/).filter(part => part);
                const opcode = parts[0];
                
                switch(opcode) {
                    case 'MOV':
                        const dest = parts[1];
                        const src = parts[2];
                        if (registers.hasOwnProperty(dest)) {
                            if (src.startsWith('0x')) {
                                registers[dest] = parseInt(src, 16);
                            } else if (!isNaN(parseInt(src))) {
                                registers[dest] = parseInt(src);
                            } else if (registers.hasOwnProperty(src)) {
                                registers[dest] = registers[src];
                            }
                        }
                        statusBar.textContent = `実行: ${instruction} - ${dest} = ${registers[dest]}`;
                        break;
                        
                    case 'ADD':
                        const addDest = parts[1];
                        const addSrc = parts[2];
                        if (registers.hasOwnProperty(addDest) && registers.hasOwnProperty(addSrc)) {
                            registers[addDest] += registers[addSrc];
                            statusBar.textContent = `実行: ${instruction} - ${addDest} = ${registers[addDest]}`;
                        }
                        break;
                        
                    case 'SUB':
                        const subDest = parts[1];
                        const subSrc = parts[2];
                        if (registers.hasOwnProperty(subDest) && registers.hasOwnProperty(subSrc)) {
                            registers[subDest] -= registers[subSrc];
                            statusBar.textContent = `実行: ${instruction} - ${subDest} = ${registers[subDest]}`;
                        }
                        break;
                        
                    case 'XOR':
                        const xorDest = parts[1];
                        const xorSrc = parts[2];
                        if (registers.hasOwnProperty(xorDest) && registers.hasOwnProperty(xorSrc)) {
                            registers[xorDest] ^= registers[xorSrc];
                            statusBar.textContent = `実行: ${instruction} - ${xorDest} = ${registers[xorDest]}`;
                        }
                        break;
                        
                    default:
                        statusBar.textContent = `未対応の命令: ${instruction}`;
                        return;
                }
                
                updateRegisterDisplay();
                
            } catch (error) {
                statusBar.textContent = `エラー: ${instruction} - ${error.message}`;
            }
        }

        function resetRegisters() {
            Object.keys(registers).forEach(reg => {
                registers[reg] = 0;
            });
            updateRegisterDisplay();
            document.getElementById('status-bar').textContent = 'レジスタをリセットしました';
        }

        function assembleCode() {
            const input = document.getElementById('assembly-input').value;
            const output = document.getElementById('assembly-output');
            
            if (!input.trim()) {
                output.textContent = 'アセンブリコードを入力してください';
                return;
            }
            
            // 簡単なアセンブル処理のシミュレーション
            const lines = input.split('\n').filter(line => line.trim());
            let machineCode = '';
            let address = 0x00400000;
            
            lines.forEach((line, index) => {
                line = line.trim();
                if (line && !line.startsWith(';')) {
                    // 簡単な機械語変換（シミュレーション）
                    let hexCode = '';
                    if (line.includes('mov')) {
                        hexCode = 'B8 0A 00 00 00';
                    } else if (line.includes('add')) {
                        hexCode = '01 D8';
                    } else if (line.includes('syscall')) {
                        hexCode = '0F 05';
                    } else {
                        hexCode = '90 90 90'; // NOP
                    }
                    
                    machineCode += `${address.toString(16).padStart(8, '0').toUpperCase()}: ${hexCode.padEnd(15)} ${line}\n`;
                    address += hexCode.split(' ').length;
                }
            });
            
            output.textContent = machineCode || '機械語コードが生成されました';
        }

        function loadExample() {
            const example = `section .data
    msg db 'Hello, Assembly!', 0xA, 0
    msg_len equ $ - msg

section .text
    global _start

_start:
    mov rax, 1      ; write システムコール
    mov rdi, 1      ; 標準出力
    mov rsi, msg    ; メッセージ
    mov rdx, msg_len ; 長さ
    syscall
    
    mov rax, 60     ; exit
    mov rdi, 0      ; 終了コード
    syscall`;
            
            document.getElementById('assembly-input').value = example;
        }

        function clearCode() {
            document.getElementById('assembly-input').value = '';
            document.getElementById('assembly-output').textContent = 'アセンブルボタンを押すと機械語が表示されます';
        }

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            updateRegisterDisplay();
            
            // スムーススクロール
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // セクションのフェードインアニメーション
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // すべてのセクションを監視
            document.querySelectorAll('.section').forEach(section => {
                section.style.opacity = '0';
                section.style.transform = 'translateY(20px)';
                section.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(section);
            });
        });
    </script>
</body>
</html>